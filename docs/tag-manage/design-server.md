# Tag 管理后端设计文档

## 1. 设计目标
为 Tag 管理页面提供稳定的 CRUD 接口能力，保证数据一致性、输入合法性和错误可解释性。

## 2. 边界与职责
- 本模块负责：
  - Tag 数据的增删改查。
  - 基础输入校验（必填、长度、格式）。
  - 业务约束校验（名称唯一）。
- 本模块不负责：
  - 内容与 Tag 的关联统计或联动删除策略。
  - 复杂权限模型（仅复用全局鉴权机制）。

## 3. 数据模型（逻辑）
- 实体：`Tag`
- 字段：
  - `id`（唯一标识）
  - `name`（唯一）
  - `description`（可空）
  - `createdAt`
  - `updatedAt`

## 4. 接口职责（tRPC）
- `tag.list`
  - 输入：可选搜索关键字。
  - 输出：Tag 列表（默认按创建时间倒序或名称排序，需在实现中固定一种规则）。
- `tag.create`
  - 输入：`name`、`description`。
  - 行为：创建 Tag，校验名称唯一。
- `tag.update`
  - 输入：`id`、`name`、`description`。
  - 行为：更新指定 Tag，校验存在性与名称唯一。
- `tag.delete`
  - 输入：`id`。
  - 行为：删除指定 Tag，校验存在性。

## 5. 数据流
1. 前端调用 tRPC `tag.*` 接口。
2. 路由层完成参数校验与鉴权检查。
3. 服务层执行业务规则（唯一性、存在性校验）。
4. 仓储/ORM 层执行数据库读写。
5. 返回标准化结果给前端，前端据此更新 UI 状态。

## 6. 鉴权策略
- 复用项目已有鉴权中间件。
- 所有写操作（create/update/delete）要求用户已登录。
- 读操作（list）按现有系统策略执行（如需鉴权则统一要求登录）。

## 7. 错误处理策略
- 参数错误：返回可读的字段级错误信息。
- 业务冲突：
  - 名称重复 -> 返回“Tag 名称已存在”。
  - 数据不存在 -> 返回“Tag 不存在或已删除”。
- 系统错误：
  - 记录日志（包含请求上下文与错误栈）。
  - 对外返回通用失败信息，避免暴露内部细节。

## 8. 一致性与扩展
- 创建、更新、删除成功后以数据库结果作为最终状态返回，避免前端猜测。
- 后续可在不破坏接口语义的前提下扩展：分页、排序、批量删除、关联计数。
